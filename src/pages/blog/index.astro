---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostCard from "../../components/PostCard.astro";
import CategoryFilter from "../../components/CategoryFilter.astro";

const posts = await getCollection("blog", ({ data }) => !data.draft);
const sortedPosts = posts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout title="Blog | Victor Augusteo" description="All blog posts about travels, tech, books, and philosophy">
  <div class="blog-header">
    <h1>All Posts</h1>
    <CategoryFilter />
  </div>

  <div class="blog-grid">
    {sortedPosts.map((post) => {
      const slug = post.id.includes('/') ? post.id.split('/')[0] : post.id;
      return (
        <PostCard
          title={post.data.title}
          description={post.data.description}
          pubDate={post.data.pubDate}
          heroImage={post.data.heroImage}
          heroAlt={post.data.heroAlt}
          category={post.data.category}
          slug={slug}
          tags={post.data.tags}
        />
      );
    })}
  </div>
</BaseLayout>

<style>
  .blog-header {
    max-width: var(--wide-width);
    margin: 0 auto;
    padding: 3rem 2rem 2rem;
    position: relative;
  }

  .blog-header h1 {
    font-family: var(--font-hand);
    font-size: 3rem;
    margin-bottom: 1.5rem;
  }

  .blog-grid {
    max-width: var(--wide-width);
    margin: 0 auto;
    padding: 0 2rem 4rem;
    display: grid;
    gap: 2.5rem;
  }
</style>
