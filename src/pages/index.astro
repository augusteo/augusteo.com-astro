---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import FeaturedCard from "../components/FeaturedCard.astro";
import Button from "../components/Button.astro";

// Get featured posts (most recent 4 with images)
const allPosts = await getCollection("blog", ({ data }) => !data.draft);
const featuredPosts = allPosts
  .filter((post) => post.data.heroImage) // Only posts with hero images
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 4);
---

<BaseLayout
  title="Victor Augusteo"
  description="Personal blog about travels, tech, books, and philosophy"
>
  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-text">
      <h1>Hi, I'm <span>Victor</span></h1>
      <p>
        Head of Engineering at Boon AI. I write about travels with my family,
        technology & AI, books I've read, and the occasional philosophical rambling.
        This is my corner of the internet.
      </p>
      <div class="hero-links">
        <Button href="/blog">Read the Blog</Button>
        <Button href="/about" variant="sage">About Me</Button>
      </div>
    </div>
    <div class="hero-portrait">
      <div class="portrait-placeholder">V</div>
    </div>
  </section>

  <!-- Divider -->
  <div class="divider">
    <div class="divider-line"></div>
  </div>

  <!-- Popular Posts -->
  <section class="section">
    <h2 class="section-title">Recent Posts</h2>

    <div class="featured-grid">
      {featuredPosts.map((post) => {
        const slug = post.id.includes('/') ? post.id.split('/')[0] : post.id;
        return (
          <FeaturedCard
            title={post.data.title}
            description={post.data.description}
            heroImage={post.data.heroImage}
            heroAlt={post.data.heroAlt}
            category={post.data.category}
            slug={slug}
          />
        );
      })}
    </div>
  </section>
</BaseLayout>

<style>
  .hero {
    max-width: var(--content-width);
    margin: 0 auto;
    padding: 5rem 2rem 4rem;
    display: grid;
    grid-template-columns: 1fr 200px;
    gap: 3rem;
    align-items: start;
    position: relative;
  }

  /* Large watercolor blob behind hero */
  .hero::before {
    content: "";
    position: absolute;
    top: -50px;
    right: -100px;
    width: 500px;
    height: 400px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 400'%3E%3Cdefs%3E%3Cfilter id='heroBlob'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.015' numOctaves='3'/%3E%3CfeDisplacementMap in='SourceGraphic' scale='40'/%3E%3CfeGaussianBlur stdDeviation='8'/%3E%3C/filter%3E%3C/defs%3E%3Cellipse cx='250' cy='200' rx='200' ry='150' fill='%2387ceeb' opacity='0.15' filter='url(%23heroBlob)'/%3E%3Cellipse cx='300' cy='250' rx='150' ry='100' fill='%238fbc8f' opacity='0.1' filter='url(%23heroBlob)'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: -1;
  }

  .hero-text h1 {
    font-family: var(--font-hand);
    font-size: 3.5rem;
    font-weight: 600;
    line-height: 1.1;
    margin-bottom: 1.5rem;
  }

  .hero-text h1 span {
    position: relative;
    display: inline-block;
  }

  /* Watercolor highlight under name */
  .hero-text h1 span::after {
    content: "";
    position: absolute;
    bottom: 2px;
    left: -8px;
    right: -8px;
    height: 20px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 20'%3E%3Cdefs%3E%3Cfilter id='nameHighlight'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.05' numOctaves='2'/%3E%3CfeDisplacementMap in='SourceGraphic' scale='5'/%3E%3CfeGaussianBlur stdDeviation='1'/%3E%3C/filter%3E%3C/defs%3E%3Cellipse cx='50' cy='10' rx='48' ry='8' fill='%238fbc8f' opacity='0.5' filter='url(%23nameHighlight)'/%3E%3C/svg%3E");
    background-size: 100% 100%;
    z-index: -1;
  }

  .hero-text p {
    font-size: 1.1rem;
    color: var(--color-ink-light);
    margin-bottom: 1.5rem;
  }

  .hero-links {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .hero-portrait {
    position: relative;
  }

  /* Watercolor splash behind portrait */
  .hero-portrait::before {
    content: "";
    position: absolute;
    top: -30px;
    left: -30px;
    right: -30px;
    bottom: -30px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 260 260'%3E%3Cdefs%3E%3Cfilter id='portraitBlob'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.02' numOctaves='3'/%3E%3CfeDisplacementMap in='SourceGraphic' scale='25'/%3E%3CfeGaussianBlur stdDeviation='3'/%3E%3C/filter%3E%3C/defs%3E%3Ccircle cx='130' cy='130' r='100' fill='%2387ceeb' opacity='0.25' filter='url(%23portraitBlob)'/%3E%3Ccircle cx='150' cy='140' r='80' fill='%23cd853f' opacity='0.15' filter='url(%23portraitBlob)'/%3E%3Ccircle cx='110' cy='120' r='70' fill='%238fbc8f' opacity='0.2' filter='url(%23portraitBlob)'/%3E%3C/svg%3E");
    z-index: 0;
  }

  .portrait-placeholder {
    width: 180px;
    height: 180px;
    background: var(--color-paper-warm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-hand);
    font-size: 4rem;
    color: var(--color-ink-light);
    position: relative;
    z-index: 1;
    /* Organic circle shape */
    border-radius: 50% 45% 55% 48% / 48% 50% 45% 52%;
    border: 2px solid var(--color-ink);
  }

  /* Divider */
  .divider {
    max-width: var(--content-width);
    margin: 2rem auto;
    padding: 0 2rem;
    height: 20px;
  }

  .divider-line {
    height: 100%;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 20'%3E%3Cpath d='M0,10 Q50,5 100,12 T200,8 T300,12 T400,8 T500,12 T600,10' stroke='%23b2bec3' stroke-width='1' fill='none'/%3E%3Ccircle cx='300' cy='10' r='3' fill='%23cd853f' opacity='0.6'/%3E%3C/svg%3E");
    background-size: 100% 100%;
    background-repeat: no-repeat;
  }

  /* Section */
  .section {
    max-width: var(--wide-width);
    margin: 0 auto;
    padding: 3rem 2rem;
  }

  .section-title {
    font-family: var(--font-hand);
    font-size: 2rem;
    margin-bottom: 1.5rem;
    position: relative;
    display: inline-block;
  }

  /* Watercolor underline */
  .section-title::after {
    content: "";
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 100%;
    height: 6px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 6'%3E%3Cpath d='M0,3 Q25,1 50,4 T100,2 T150,4 T200,3' stroke='%232d3436' stroke-width='2' fill='none' opacity='0.3'/%3E%3C/svg%3E");
    background-size: 100% 100%;
  }

  .section-title::before {
    content: "";
    position: absolute;
    left: -1.5rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.8rem;
    color: var(--color-accent-terracotta);
  }

  /* Featured grid */
  .featured-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2rem;
  }

  @media (max-width: 900px) {
    .featured-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .hero {
      grid-template-columns: 1fr;
      text-align: center;
      padding-top: 3rem;
    }

    .hero-portrait {
      order: -1;
      justify-self: center;
    }

    .hero-links {
      justify-content: center;
    }
  }
</style>
